# Unbind all keys
unbind-key -a

# My prefix is Ctrl-s
set -g prefix 'C-s'

set -g default-terminal "tmux-256color"
set-option -g default-shell /bin/zsh
set-option -g destroy-unattached off

bind          '(' switch-client -p
bind          ')' switch-client -n
bind          '!' break-pane
bind          '{' swap-pane -U
bind          '}' swap-pane -D
bind          '#' list-buffers
bind          '$' command-prompt 'rename-session %%'
bind          ',' command-prompt 'rename-window %%'
bind          '1' select-window -t :1
bind          '2' select-window -t :2
bind          '3' select-window -t :3
bind          '4' select-window -t :4
bind          '5' select-window -t :5
bind          '6' select-window -t :6
bind          '7' select-window -t :7
bind          '8' select-window -t :8
bind          '9' select-window -t :9
bind          ':' command-prompt
bind          ';' last-pane
bind          '?' list-keys
bind          '[' copy-mode
bind          ']' paste-buffer
bind          'b' choose-buffer
bind          'c' new-window -c "#{pane_current_path}"
bind          'd' detach-client
bind          'h' select-pane -L
bind          'j' select-pane -D
bind          'k' select-pane -U
bind          'l' select-pane -R
bind          'o' select-pane -t :.+
bind          'p' display-panes -d 0
bind          'r' source-file ~/.tmux.conf \; display '~/.tmux.conf sourced'
bind          's' split-window -v -c "#{pane_current_path}"
bind          't' clock-mode
bind          'v' split-window -h -c "#{pane_current_path}"
bind          'w' choose-window
bind          'x' confirm-before -p "kill-pane #P? (y/n)" kill-pane
bind          'z' resize-pane -Z
bind          Tab last-window # move to last active window
bind        Enter copy-mode # enter copy mode
bind          '/' copy-mode \; send-keys '/'
bind        Space next-layout
bind -n       C-l send-keys C-l \; run 'sleep 0.05 && tmux clear-history'
bind -r      M-Up resize-pane -U 5
bind -r    M-Down resize-pane -D 5
bind -r    M-Left resize-pane -L 5
bind -r   M-Right resize-pane -R 5

# start window numbers at 1
set -g base-index 1

# Automatically set window title
setw -g automatic-rename on
setw -g status-interval 5
setw -g automatic-rename-format '#{b:pane_current_path}'

set -g set-titles on
set -g set-titles-string '#h ❐ #S ● #I #W'

# renumber windows when a window is closed
set -g renumber-windows on

set -g status-keys vi
set -g history-limit 1000000

setw -g mode-keys vi
setw -g monitor-activity on

# No delay for escape key press
set -sg escape-time 0

set -g mouse on
set -g @emulate-scroll-for-no-mouse-alternate-buffer "on"

# need this to autosave in vim on lost focus
set -g focus-events on

# catppuccin config (options must be set before TPM loads the plugin)
source-file -q ~/.config/tinted-theming/catppuccin-tmux.conf
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_text " #W"
set -g @catppuccin_window_current_text " #W"
set -g @catppuccin_status_left_separator ""
set -g @catppuccin_status_right_separator ""
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_date_time_text " %I:%M"
setw -g window-status-separator " "

# stay selected when using mouse to select
# https://github.com/tmux/tmux/issues/140#issuecomment-302742783
unbind -T copy-mode-vi MouseDragEnd1Pane

# copy selection to clipboard
set -g set-clipboard on
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "pbcopy"

set -as terminal-overrides '*:Ss=\E[%p1%d q:Se=\E[ q'
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
set -as terminal-overrides ',*:Setulc=\E[58::2::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m'  # underscore colours - needs tmux-3.0
set -as terminal-overrides ',xterm-256color:RGB'

set -g allow-passthrough 'all'

# custom spotify module
%hidden MODULE_NAME="spotify"
set -g "@catppuccin_${MODULE_NAME}_icon" " "
set -gF "@catppuccin_${MODULE_NAME}_color" "#{E:@thm_green}"
set -g "@catppuccin_${MODULE_NAME}_text" " #(tmux-spotify-info)"
source ~/.tmux/plugins/tmux/utils/status_module.conf

set -g @plugin 'nhdaly/tmux-better-mouse-mode'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @plugin 'catppuccin/tmux'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @thumbs-command 'echo -n {} | pbcopy'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
# Press prefix + I (capital i, as in Install) to fetch the plugin.
run '~/.tmux/plugins/tpm/tpm'

# status line (must be after TPM loads catppuccin)
set -g status-right-length 200
set -g status-left "#{E:@catppuccin_status_session} "
set -g status-right "#{?#(tmux-spotify-info), #{E:@catppuccin_status_spotify},}"
set -agF status-right " #{E:@catppuccin_status_battery}"
set -ag status-right " #{E:@catppuccin_status_date_time}"
set -ag status-right " #{E:@catppuccin_status_host}"

run '~/.tmux/plugins/tmux-battery/battery.tmux'
